@page "{id:int}"
@model CoreEstate.Pages.ForSale.DetailsModel
@using CoreEstate.Models

@{
    ViewData["Title"] = Model.ForSaleProperty.Name + " for sale";
}

<div class="container">
    <div class="row">
        <h1>@ViewData["Title"]</h1>
        <hr />

        <div class="icon-navigation">
            <a asp-page="./Index">
                <div class="icon-navigation-icon">
                    <i data-fa-symbol="back-arrow" class="fa-solid fa-arrow-left"></i>
                    <svg class="icon"><use href="#back-arrow"></use></svg>
                </div>
                <div class="icon-navigation-text">
                    Back to property results
                </div>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-9">
            <div class="row">
                @if (Model.ForSaleProperty.Photos.Count > 0)
                {
                    <div id="propertyPhotosCarousel" class="carousel slide">
                        <div class="carousel-indicators">
                            @{
                                var photoCount = 0;
                            }
                            @foreach (var item in Model.ForSaleProperty.Photos)
                            {
                                @if (photoCount == 0)
                                {
                                    <button type="button" data-bs-target="#propertyPhotosCarousel" data-bs-slide-to="@photoCount" class="active" aria-current="true" aria-label="Property photo"></button>
                                }
                                else
                                {
                                    <button type="button" data-bs-target="#propertyPhotosCarousel" data-bs-slide-to="@photoCount" aria-label="Property photo"></button>
                                }

                                photoCount++;
                            }
                        </div>
                        <div class="carousel-inner">
                            @{
                                photoCount = 0;
                            }
                            @foreach (var item in Model.ForSaleProperty.Photos)
                            {
                                @if (photoCount == 0)
                                {
                                    <div class="carousel-item active">
                                        <img class="img-fluid d-block rounded" src="~/uploads/@item.Filename" />
                                    </div>
                                }
                                else
                                {
                                    <div class="carousel-item">
                                        <img class="img-fluid d-block rounded" src="~/uploads/@item.Filename" />
                                    </div>
                                }

                                photoCount++;
                            }
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#propertyPhotosCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#propertyPhotosCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                }
                else
                {
                    <img class="img-fluid rounded" src="~/uploads/no-image-available.png" />
                }
            </div>

            <div class="row">
                <dl>
                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.ForSaleProperty.Price)
                    </dt>
                    <dd class="col-sm-10">
                        @Html.DisplayFor(model => model.ForSaleProperty.Price)
                    </dd>
                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.ForSaleProperty.IsFreehold)
                    </dt>
                    <dd class="col-sm-10">
                        @Html.DisplayFor(model => model.ForSaleProperty.IsFreehold)
                    </dd>
                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.ForSaleProperty.Name)
                    </dt>
                    <dd class="col-sm-10">
                        @Html.DisplayFor(model => model.ForSaleProperty.Name)
                    </dd>
                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.ForSaleProperty.Address)
                    </dt>
                    <dd class="col-sm-10">
                        @Html.DisplayFor(model => model.ForSaleProperty.Address)
                    </dd>
                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.ForSaleProperty.Description)
                    </dt>
                    <dd class="col-sm-10">
                        @Html.DisplayFor(model => model.ForSaleProperty.Description)
                    </dd>
                </dl>
            </div>

            <div class="row">
                @if (User.Identity != null && User.Identity.IsAuthenticated)
                {
                    @if (User.IsInRole(RoleName.IsPropertyManager))
                    {
                        <div class="icon-navigation">
                            <a asp-page="./Viewings" asp-route-id="@Model.ForSaleProperty.Id">
                                <div class="icon-navigation-icon">
                                    <i data-fa-symbol="eye-viewing" class="fa-solid fa-eye"></i>
                                    <svg class="icon"><use href="#eye-viewing"></use></svg>
                                </div>
                                <div class="icon-navigation-text">
                                    Viewings
                                </div>
                            </a>
                        </div>
                    }
                    else
                    {
                        <div class="icon-navigation">
                            <a asp-page="./Request" asp-route-id="@Model.ForSaleProperty.Id">
                                <div class="icon-navigation-icon">
                                    <i data-fa-symbol="eye-viewing" class="fa-solid fa-eye"></i>
                                    <svg class="icon"><use href="#eye-viewing"></use></svg>
                                </div>
                                <div class="icon-navigation-text">
                                    Request viewing
                                </div>
                            </a>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>
